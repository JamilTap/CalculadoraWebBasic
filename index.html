<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora</title>
  <style>
  
 body {
      margin: 0;
      height: 100vh;
      background: linear-gradient(45deg, #ff00cc, #3333ff, #00ffcc, #ffcc00);
      background-size: 600% 600%;
      animation: psicodelico 10s ease infinite;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: sans-serif;
      color: rgb(0, 0, 0);
    }

    @keyframes psicodelico {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    h1 {
      font-size: 3em;
      text-shadow: 0 0 10px white, 0 0 20px magenta;
    }
 .prueba-btn.basico {
      background-color: #4CAF50;
      color: white;
    }

    .prueba-btn.medio {
      background-color: #FFC107;
      color: #333;
    }

    .prueba-btn.extremo {
      background-color: #F44336;
      color: white;
    }

    .emoji {
      font-size: 1.2em;
    }
    
    .calculadora {
      width: 400px;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
      background-color: #fafbfb;
    }

    .pantalla {
      padding: 20px;
      background-color: #1e1b1b;
      text-align: right;
    }

    #pantalla {
      width: 100%;
      height: 60px;
      border: none;
      background-color: transparent;
      color: white;
      font-size: 2.5rem;
      text-align: right;
      padding: 0 10px;
      box-sizing: border-box;
      outline: none;
      caret-color: white;
      animation: parpadeo 1s step-start 0s infinite;
    }

    @keyframes parpadeo {
      50% { caret-color: transparent; }
    }

    #operacion-anterior {
      color: rgba(255, 255, 255, 0.7);
      font-size: 1.2rem;
      height: 20px;
    }

    .botones {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1px;
      background-color: #7f8c8d;
    }

    button {
      border: none;
      height: 70px;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
      background-color: #ecf0f1;
      user-select: none;
    }

    button:hover:not(:disabled) { background-color: #bdc3c7; }
    button:active:not(:disabled) { transform: scale(0.95); }
    button:disabled { opacity: 0.5; cursor: not-allowed; }

    .operador { background-color: #f39c12; color: white; }
    .operador:hover:not(:disabled) { background-color: #e67e22; }

    .limpiar { background-color: #e74c3c; color: white; }
    .limpiar:hover:not(:disabled) { background-color: #c0392b; }

    .igual { background-color: #2ecc71; color: white; }
    .igual:hover:not(:disabled) { background-color: #27ae60; }

    .historial {
      background: #f7f7f7;
      padding: 10px;
      max-height: 150px;
      overflow-y: auto;
    }

    .historial h3 {
      margin: 5px 0;
    }

    .historial ul {
      list-style: none;
      padding-left: 10px;
    }

    .historial li {
      font-size: 0.9rem;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="calculadora">
    <div class="pantalla">
      <div id="operacion-anterior"></div>
      <input type="text" id="pantalla" autofocus readonly />
    </div>
    <div class="botones">
      <button class="limpiar" onclick="limpiar()">C</button>
      <button class="operador" onclick="agregarOperador('%')">%</button>
      <button class="operador" onclick="agregarOperador('/')">/</button>
      <button class="operador" onclick="agregarOperador('*')">*</button>

      <button onclick="agregarNumero('7')">7</button>
      <button onclick="agregarNumero('8')">8</button>
      <button onclick="agregarNumero('9')">9</button>
      <button class="operador" onclick="agregarOperador('-')">-</button>

      <button onclick="agregarNumero('4')">4</button>
      <button onclick="agregarNumero('5')">5</button>
      <button onclick="agregarNumero('6')">6</button>
      <button class="operador" onclick="agregarOperador('+')">+</button>

      <button onclick="agregarNumero('1')">1</button>
      <button onclick="agregarNumero('2')">2</button>
      <button onclick="agregarNumero('3')">3</button>
      <button class="igual" id="btn-igual" onclick="calcular()">=</button>

      <button onclick="agregarNumero('0')">0</button>
      <button onclick="agregarNumero('.')">.</button>
      <button onclick="agregarParentesis('(')">(</button>
      <button onclick="agregarParentesis(')')">)</button>

      <button style="grid-column: span 4;" onclick="borrarUltimo()">‚Üê</button>
    </div>
    
    <div class="historial">
      <h3>Historial</h3>
      <ul id="lista-historial"></ul>
    </div>
  </div>
  
<div class="pruebas-sidebar">
      <button class="prueba-btn basico" onclick="pruebasAutomaticas()">
        <span class="emoji">üß™</span> Pruebas B√°sicas
      </button>
      <button class="prueba-btn medio" onclick="pruebasPesadas()">
        <span class="emoji">‚ö°</span> Pruebas Medias
      </button>
      <button class="prueba-btn extremo" onclick="pruebasExtremass()">
        <span class="emoji">üöÄ</span> Pruebas Extremas
      </button>
    </div>

  <script>
  const pantalla = document.getElementById('pantalla');
  const btnIgual = document.getElementById('btn-igual');
  const historial = document.getElementById('lista-historial');

  function agregarNumero(numero) {
    if (pantalla.value === 'Error') {
      pantalla.value = '';
      activarIgual();
    }
    pantalla.value += numero;
  }

  function agregarOperador(operador) {
    const ultimoCaracter = pantalla.value.slice(-1);
    if (!['+', '-', '*', '/', '%'].includes(ultimoCaracter) && pantalla.value !== 'Error') {
      pantalla.value += operador;
    }
  }

  function agregarParentesis(par) {
    if (pantalla.value === 'Error') {
      pantalla.value = '';
      activarIgual();
    }
    pantalla.value += par;
  }

  function calcular() {
    const operacionAnterior = document.getElementById('operacion-anterior');
    try {
      const operacion = pantalla.value;
      const tiempoInicio = performance.now();

      // Eval√∫a con funciones matem√°ticas permitidas
      const resultado = Function('"use strict"; return (' + transformarExpresion(operacion) + ')')();

      const tiempoFin = performance.now();
      const tiempo = (tiempoFin - tiempoInicio).toFixed(4);

      operacionAnterior.textContent = operacion + ' =';
      pantalla.value = resultado;

      const li = document.createElement('li');
      li.innerHTML = `‚úÖ <strong>${operacion} = ${resultado}</strong> <span style="color:gray">(${tiempo} ms)</span>`;
      historial.appendChild(li);
    } catch (error) {
      pantalla.value = 'Error';
      const li = document.createElement('li');
      li.innerHTML = `‚ùå <strong>Error: ${error.message}</strong>`;
      historial.appendChild(li);
      desactivarIgual();
    }
  }

  function transformarExpresion(expr) {
    // Soporte b√°sico para funciones matem√°ticas
    return expr
      .replace(/\bsqrt\b/g, 'Math.sqrt')
      .replace(/\bsin\b/g, 'Math.sin')
      .replace(/\bcos\b/g, 'Math.cos')
      .replace(/\btan\b/g, 'Math.tan')
      .replace(/\blog\b/g, 'Math.log')
      .replace(/\bpi\b/gi, 'Math.PI')
      .replace(/\be\b/gi, 'Math.E')
      .replace(/\babs\b/g, 'Math.abs')
      .replace(/\bpow\b/g, 'Math.pow')
      .replace(/\bexp\b/g, 'Math.exp');
  }

  function limpiar() {
    pantalla.value = '';
    document.getElementById('operacion-anterior').textContent = '';
    activarIgual();
  }

  function borrarUltimo() {
    if (pantalla.value === 'Error') {
      pantalla.value = '';
      activarIgual();
      return;
    }
    pantalla.value = pantalla.value.slice(0, -1);
  }

  function desactivarIgual() {
    btnIgual.disabled = true;
    btnIgual.style.opacity = '0.5';
    btnIgual.style.cursor = 'not-allowed';
  }

  function activarIgual() {
    btnIgual.disabled = false;
    btnIgual.style.opacity = '1';
    btnIgual.style.cursor = 'pointer';
  }

  document.addEventListener('keydown', function (e) {
    const teclasValidas = '0123456789+-*/().%';
    const esControl = ['Enter', 'Backspace', 'Escape'];

    if (pantalla.value === 'Error' && '0123456789'.includes(e.key)) {
      pantalla.value = '';
      activarIgual();
    }

    if (teclasValidas.includes(e.key)) {
      pantalla.value += e.key;
    } else if (e.key === 'Enter') {
      e.preventDefault();
      if (!btnIgual.disabled) calcular();
    } else if (e.key === 'Backspace') {
      borrarUltimo();
    } else if (e.key === 'Escape') {
      limpiar();
    } else if (!esControl.includes(e.key)) {
      e.preventDefault();
    }
  });

  // üî¨ Funci√≥n para pruebas matem√°ticas autom√°ticas
  function pruebasAutomaticas() {
    const pruebas = [
      "5+5*2",
      "sqrt(144)",
      "pow(2,10)",
      "log(100)",
      "sin(pi/2)",
      "abs(-50)",
      "exp(1)",
      "tan(45)", // en radianes
      "1/0",      // infinito
      "5++5",     // error
      "sqrt(-1)", // error NaN
    ];

    historial.innerHTML += `<li>üß™ <strong>Iniciando pruebas autom√°ticas...</strong></li>`;
    pruebas.forEach(expr => {
      pantalla.value = expr;
      calcular();
    });
  }
  function pruebasPesadas() {
  historial.innerHTML += `<li>üî• <strong>Iniciando pruebas pesadas de rendimiento...</strong></li>`;

  const pruebas = [
    {
      descripcion: "C√°lculo de pow(999999, 1000)",
      operacion: () => Math.pow(999999, 1000)
    },
    {
      descripcion: "Suma de 10 millones de n√∫meros",
      operacion: () => {
        let suma = 0;
        for (let i = 0; i < 1e7; i++) {
          suma += i;
        }
        return suma;
      }
    },
    {
      descripcion: "Calcular factorial de 10000",
      operacion: () => {
        let res = BigInt(1);
        for (let i = BigInt(2); i <= 10000n; i++) {
          res *= i;
        }
        return res.toString().slice(0, 30) + "..."; // Evita bloqueo
      }
    },
    {
      descripcion: "Sumar serie de 1/n¬≤ hasta 10 millones",
      operacion: () => {
        let suma = 0;
        for (let i = 1; i <= 1e7; i++) {
          suma += 1 / (i * i);
        }
        return suma;
      }
    }
  ];

  pruebas.forEach(test => {
    const inicio = performance.now();
    let resultado;
    try {
      resultado = test.operacion();
      const fin = performance.now();
      const li = document.createElement('li');
      li.innerHTML = `‚úÖ <strong>${test.descripcion}</strong> ‚Üí <em>Resultado:</em> ${resultado} <span style="color:gray">(${(fin - inicio).toFixed(2)} ms)</span>`;
      historial.appendChild(li);
    } catch (error) {
      const li = document.createElement('li');
      li.innerHTML = `‚ùå <strong>${test.descripcion}</strong> ‚Üí Error: ${error.message}`;
      historial.appendChild(li);
    }
  });
}
if (performance.memory) {
  console.log(performance.memory);
}
//pruebas extremas
function pruebasExtremass() {
  historial.innerHTML += `<li>‚ö†Ô∏è <strong>Pruebas EXTREMAS de rendimiento y memoria</strong></li>`;

  const pruebas = [
    {
      descripcion: "üî¢ 1 mill√≥n de ra√≠ces cuadradas",
      operacion: () => {
        let total = 0;
        for (let i = 1; i <= 1_000_000; i++) {
          total += Math.sqrt(i);
        }
        return total;
      }
    },
    {
      descripcion: "üìà 100 mil operaciones matem√°ticas aleatorias",
      operacion: () => {
        let total = 0;
        for (let i = 0; i < 100_000; i++) {
          let a = Math.random() * 1000;
          let b = Math.random() * 1000;
          total += Math.sin(a) + Math.log(b) + a * b / (a + 1);
        }
        return total.toFixed(2);
      }
    },
    {
      descripcion: "üßÆ Multiplicaci√≥n de matrices 200x200",
      operacion: () => {
        const size = 200;
        const A = Array.from({ length: size }, () => Array.from({ length: size }, () => Math.random()));
        const B = Array.from({ length: size }, () => Array.from({ length: size }, () => Math.random()));
        const result = Array.from({ length: size }, () => Array(size).fill(0));

        for (let i = 0; i < size; i++) {
          for (let j = 0; j < size; j++) {
            for (let k = 0; k < size; k++) {
              result[i][j] += A[i][k] * B[k][j];
            }
          }
        }

        return result[0][0].toFixed(4); // Solo muestra una celda
      }
    },
    {
      descripcion: "üß† Procesamiento de array gigante (1 mill√≥n elementos)",
      operacion: () => {
        const arr = Array.from({ length: 1_000_000 }, (_, i) => i + 1);
        const filtrado = arr.filter(n => n % 2 === 0);
        const mapeado = filtrado.map(n => Math.sqrt(n));
        const suma = mapeado.reduce((acc, val) => acc + val, 0);
        return suma.toFixed(2);
      }
    },
    {
      descripcion: "üîÅ C√°lculo recursivo de Fibonacci (simulado hasta 1000000)",
      operacion: () => {
        let a = 0n, b = 1n;
        for (let i = 0; i < 1_000_000; i++) {
          [a, b] = [b, a + b];
        }
        return a.toString().slice(0, 20) + '...'; // Trunca para evitar freeze
      }
    }
  ];

  pruebas.forEach(test => {
    const inicio = performance.now();
    let resultado;
    try {
      resultado = test.operacion();
      const fin = performance.now();
      const li = document.createElement('li');
      li.innerHTML = `‚úÖ <strong>${test.descripcion}</strong> ‚Üí <em>Resultado:</em> ${resultado} <span style="color:gray">(${(fin - inicio).toFixed(2)} ms)</span>`;
      historial.appendChild(li);
    } catch (error) {
      const li = document.createElement('li');
      li.innerHTML = `‚ùå <strong>${test.descripcion}</strong> ‚Üí Error: ${error.message}`;
      historial.appendChild(li);
    }
  });
  
}
it('prueba lenta', function() {
  this.timeout(5000); // 5 segundos
  // c√≥digo de prueba
});
</script>



</body>

</html>


